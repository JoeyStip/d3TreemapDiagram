<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <link href="index.css" rel="stylesheet">
        <title>Treemap Diagram</title>
        <link rel="shortcut icon" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSoIUt2rXoze_Zrmbk7ZmjWcvUdyDFz-Bm0gQ&s">
    </head>
    <body>     
        <script type="module">
            import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";

            const margin = {
                left: 50, 
                right: 50,
                top: 10,
                bottom: 150
            };

            const w = 1000 - margin.left - margin.right;
            const h = 900 - margin.top - margin.bottom;
            const colors = {
                'Action': "#66c2a5",
                'Drama': '#fc8d62',
                'Adventure': '#8da0cb',
                'family': '#e78ac3',
                'Animation': '#a6d854',
                'Comedy': '#ffd92f',
                'Biography': '#e5c494'
            }

            const container = d3
                .select("body")
                .append("div")
                .attr("id", "container");

            const titleAndDesc = container
                .append("div")
                .attr('id', 'titleAndDesc');

            const title = titleAndDesc
                .append("h1")
                .text("Treemap Diagram")
                .attr("id", 'title');

            const desc = titleAndDesc
                .append("h3")
                .text("a neat little description")
                .attr('id', 'description')
            
            const canvas = container
                .append("svg")
                .attr("id", "canvas")
                .attr("width", w)
                .attr("height", h)
                .attr('transform', 'translate(' + margin.left +',' + margin.top + ')');


            fetch('https://cdn.freecodecamp.org/testable-projects-fcc/data/tree_map/movie-data.json')
                .then(response => response.json())
                .then(data => {
                    console.log(data)
                    const root = d3
                        .hierarchy(data)
                        .sum((d)=>d.value)
                        .sort((a, b) => b.height - a.height || b.value - b.value);

                    d3.treemap()
                        .size([w,h])
                        .padding(2)
                        (root)

                    const rectGroups = canvas
                        .selectAll("rect")
                        .data(root.leaves())
                        .enter()
                        .append("g")
                        .attr("id", (d)=>d.data.name)

                    const rectangles = rectGroups
                        .append("rect")
                        .attr("x", (d)=>d.x0)
                        .attr('y', (d)=>d.y0)
                        .attr("width", (d)=>d.x1-d.x0)
                        .attr("height", (d)=>d.y1-d.y0)
                        .style("stroke", 'black')
                        .style('fill', (d)=>{
                            return colors[d.data.category];
                        })
                        .attr("class", "tile")
                        .attr("data-name", (d)=>d.data.name)
                        .attr("data-category", (d)=>d.data.category)
                        .attr("data-value", (d)=>d.data.value);

                    const text = rectGroups
                        .append("text")
                        .selectAll('tspan')
                        .data((d)=>{
                            return d.data.name.split(/(?=[A-Z][^A-Z])/g)
                                .map((v)=>{
                                    return {
                                        text: v,
                                        x0: d.x0,
                                        y0: d.y0
                                    }
                                });
                        })
                        .enter()
                        .append('tspan')
                        .attr('x',(d)=>d.x0+5)
                        .attr('y', (d, i)=>d.y0+15 + (i * 10))
                        .text((d)=>d.text)
                        .attr('font-size', '0.6em')
                        .attr('fill', 'white')
                    
                });
 
        </script>
        <script src='https://cdn.freecodecamp.org/testable-projects-fcc/v1/bundle.js'></script>
    </body>
</html>